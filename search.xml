<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>恶意域名的相关特征</title>
      <link href="/2019/08/19/%E6%81%B6%E6%84%8F%E5%9F%9F%E5%90%8D/"/>
      <url>/2019/08/19/%E6%81%B6%E6%84%8F%E5%9F%9F%E5%90%8D/</url>
      
        <content type="html"><![CDATA[<p><img src="/2019/08/19/恶意域名/%E5%9F%9F%E5%90%8D.jpeg" alt="恶意域名"></p><p>DNS隧道，顾名思义，肯定是数据隐含在DNS数据包中进行传输，我们还有其它隧道，如HTTPS、HTTP proxy，tcp等，因为这些协议的端口一般企业防火前和入侵检测是不会限制的，这为如远程执行，僵尸网络提供了方便。那针对流量这部分，思路就是要先提取出这部分流量，然后在进行可能存在的恶意行为进行检测。其它隧道的检测也类似。<br>​<br>常见的建立DNS隧道的工具有：ioline、dnscat2、dns2tcp等。那相关的DNS的数据都会通过这个隧道进行传输，在建立完DNS隧道后，我们可以使用抓包工具如tcpdump专门抓取DNS 53协议的数据，这里面就可能存在其它隐含数据，而如果需要使用机器学习来进行辅助检测，那就得把流量数据考虑成文本，使用conv1d来进行基于文本的检测。流量文本可以使用tshark工具来进行转换。<br>​<br>恶意域名检测特征维度：<br>​</p><ul><li>alex排名</li><li>搜狗排名</li><li>搜索、百度收录数量</li><li>必应收录数量</li><li>网站首页完整度（一般恶意域名不会有web站点解析，据此可考虑该网址是否能够抓取到媒体资源来判断，或者使用head less浏览器去访问，如phantomjs）</li><li>是否是主流域名后缀，如.com，.net，.cn等都是正常域名</li><li>地理位置</li><li>A记录与CNAME，一般企业A记录和CNAME记录都会有，恶意域名可能只有A记录</li><li>其它特征：<ul><li>WHOIS匿名</li><li>域名更新频率</li><li>是否使用CDN，木马、webshell类域名不会使用CDN加速</li></ul></li></ul><p>黑客实施攻击会使用的恶意域名：<br>​<br>木马回连、病毒通讯、反弹shell、SSRF、XSS、DDoS、挂马、矿机、DNS隧道木马等<br>​<br>其它恶意域名应用，如博彩、色情、垃圾邮件、毒品、军事、钓鱼等<br>​<br>一般的用DNS隧道进行隐蔽数据传输会使用DNS中的TXT/MX/CNAME记录，用的比较多的就是TXT记录，针对这种情况，我们就可以想到其对应的检测分析：<br>​</p><ol><li>时间窗口内，TXT记录激增；</li><li>正常DNS查询，任何记录类型都会有，而恶意的行为，只有限制在A，AAAA，NS等，基于此，可以统计查询记录的数量；</li><li>DNS隧道中的数据都是经过编码的，其字符是不符合zipf定理的，也就是可能是平均分布的，另外还可以统计词频平均斜率；</li><li>统计请求/响应DNS的平均字符，最大，最小字符长度，一般是请求长，响应短；</li><li>根据数据包的五元组聚类，异常流量显著不同于正常流量；<ul><li>DNS的会话时长<ul><li>隧道木马一般使用的UPD套接字会很长，也会复用</li></ul></li><li>DNS会话中的数据包总数<ul><li>异常的数据包一般会较大</li></ul></li><li>上行大包栈请求报文的比例<ul><li>查询字节数大于50，可称为大包；</li><li>异常上传大包的情况较多；</li><li>强行拆分，会出现多个等同大小的数据包；</li><li>隧道木马中，DNS报文总数和DNS报文长度是负相关的</li></ul></li><li>下行小包栈响应报文比例<ul><li>正常的DNS响应较大；异常则简短，一般小于50</li></ul></li><li>有效载荷上传下载比<ul><li>交互通信时（请求过后），控制字段少，响应多，正常情况则相反；</li></ul></li><li>有效载荷部分是否加密<ul><li>加密，可疑</li></ul></li><li>域名对应的主机数量<ul><li>主机数量明显大于正常DNS通信；</li></ul></li><li>FQDN数异常检测<ul><li>一定时间窗口多于正常；</li></ul></li><li>总的查询报文载荷量<ul><li>明显大于正常水平</li></ul></li></ul></li><li>响应时间</li><li>计算查询和响应的信息熵，或平均信息熵</li><li>发包频率<ul><li>容易与DNS Flood流量混淆，方法是计算DNS会话包之前的均值/方差等特征，以区分开；</li></ul></li><li>以上基于DNS会话的特征，还可以从查询访问角度<ul><li>域名被访问频率<ul><li>很少访问；</li><li>新域名；</li><li>会有无响应的域名；</li></ul></li><li>TTL<ul><li>TTL较短</li></ul></li><li>时间窗口</li><li>域名变更频率</li></ul></li><li>域名本身<ul><li>域名随机字符串，词频特征</li><li>域名信息熵</li><li>字符分布（可读性/易读性）</li></ul></li><li>IP特征<ul><li>不同子网响应</li><li>源目的地址，位于不同国家，或区域，跨度大</li></ul></li><li>域名注册信息<ul><li>whois匿名等</li></ul></li></ol><p>数据建模，先基线过滤（比如连续7天出现未曾数据DNS查询流量），结合异常检测算法。</p><p>参考：</p><ul><li><a href="https://www.freebuf.com/articles/es/187451.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/es/187451.html</a></li><li><a href="https://www.cnblogs.com/LittleHann/p/8656621.html" target="_blank" rel="noopener">https://www.cnblogs.com/LittleHann/p/8656621.html</a><br>​</li></ul>]]></content>
      
      
      <categories>
          
          <category> 恶意域名 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 恶意域名 </tag>
            
            <tag> 特征抽取 </tag>
            
            <tag> 异常检测 </tag>
            
            <tag> 统计分析 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 深度学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于爱情</title>
      <link href="/2019/08/18/%E5%85%B3%E4%BA%8E%E7%88%B1%E6%83%85/"/>
      <url>/2019/08/18/%E5%85%B3%E4%BA%8E%E7%88%B1%E6%83%85/</url>
      
        <content type="html"><![CDATA[<p><img src="/2019/08/18/关于爱情/LoveTree.jpg" alt="爱情树"></p><h4 id="什么是爱情？"><a href="#什么是爱情？" class="headerlink" title="什么是爱情？"></a>什么是爱情？</h4><p>什么是爱情呢？关于爱情，人们似乎又有很多想说的，但却又欲言欲止… 爱情不是魔法，但却让人无限神往！</p><p>那什么是爱情呢？或许爱情从亚当与夏娃初尝禁果时便产生了，又谁知道呢？！那这么说爱情便是产生于“性”了？！或许是吧，那又或许不是，如果说开始是，那后来慢慢就不是了…</p><p>那到底什么是爱情呢？其实，我们也并不需要什么明确的定义来框住“她”，因为她本来就是感性的，多变的… 常有听言，爱情是什么多巴胺、费洛蒙，或许那是生物学上对其“产中”给出的一点点解释，其实，爱情还真如魔法，放在特定的情景下，会有不同的感觉… 记得心理学家佛洛依德曾说过，人一生中最伟大的两件事：爱情与工作！至此，我相信爱情的伟大，或许能拯救人类也说不准呢!</p><p>我更相信，爱情，“她”是人类情感更高层次的演变与升华，源于其它情感，又高于其它情感…</p><h4 id="爱情的“骂名”？！"><a href="#爱情的“骂名”？！" class="headerlink" title="爱情的“骂名”？！"></a>爱情的“骂名”？！</h4><p>似乎爱情在奔跑、成长的过程中慢慢变了质，人们渐渐不再相信“她”，但又悄悄将其藏于内心深处，期待有机会再次遇见！</p><p>现实生活中的“爱情”被人性的“丑恶”给打到，那绝对是人类的悲哀！是人类赋予了“爱情”意义，但又狠狠地将其抛弃… “爱情”始终未变，变化的永远是人类自己，变质的是人的内心啊！</p><h4 id="美好的爱情啊！"><a href="#美好的爱情啊！" class="headerlink" title="美好的爱情啊！"></a>美好的爱情啊！</h4><p>爱情的伟大，源自于是人类对美好的一种向往，或者更激进点来说，是一种神往，所以，爱情，她是需要有人类美好品质作为铺垫的，不然是无法生长的！对爱情有美好期许的前提，是需要你有单纯、善良、无私等美好品质的，而恰巧这在现实生活中，却更容易失去，所谓，人在成长的过程中不断被“欲望”吞噬，一边遗忘，一边失去，美好的爱情也将离你而去！</p><p>无条件付出，或许是爱情最核心的力量，那是一种怀着满腔热血，面对刀山火海，依然愿意为之付出的精神！我们都容易被影视剧中的这种场景所感动，那其实就是我们内心深处最直白的期许，一种愿意用自己的“生命”为之付出的伟大存在感，那是自己生命在对方心里的一种神圣地位！至此，如能说窥探出“爱情”的些许本质，那就是爱情的美好表征，正映射出自己生命的伟大，被认同，被感知存在，这也是作为渺小人类，潜在的对生命，对自然的呐喊吧！</p><h4 id="中国式的“爱情”…"><a href="#中国式的“爱情”…" class="headerlink" title="中国式的“爱情”…"></a>中国式的“爱情”…</h4><p>在中国，似乎并不具备这种美好的土壤… 中国式的“爱情”，常常被绑架，那顶多是感情！中国，从古至今，基本上一直延续的是”媒约制“，有无伟大爱情孕育过，或许有，常有人说，中国有什么四大爱情经典，那或许只是古人的”意淫”！拿到现在，很多固有的约束依然存在，渐渐要在年轻人中看到些许微弱的“绿光”，也快被掐灭…</p><p>至此，大多数中国人只能怀着“美好的期许”步入婚姻，中国式的婚姻又是一团乱麻，婚前没达到的心理期许，婚后，很可能会成为一颗炸弹…</p><h4 id="总结…"><a href="#总结…" class="headerlink" title="总结…"></a>总结…</h4><p>很多人，总会为“先有鸡先有蛋”的问题烦恼，对于爱情，你若相信，她便会给你无穷力量！</p><p>有人说，爱情会慢慢趋于平淡，退化为其它情感，或许是，或许又不是，当你在某种场景下时，那时候涌现出的还是爱情！</p><p>同样，爱情也是需要“运营”的，以此来形成一种长久的羁绊，前提是你选择了”她”，并且拥有一颗虔诚的心，那是你对爱情的信仰！</p><p>（注：此文写给自己，亦是写给相信爱情的人，仅表个人！）</p>]]></content>
      
      
      <categories>
          
          <category> 爱情 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 爱情 </tag>
            
            <tag> 生命 </tag>
            
            <tag> 善良 </tag>
            
            <tag> 单纯 </tag>
            
            <tag> 无私 </tag>
            
            <tag> 存在感 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于安卓APK的一点知识</title>
      <link href="/2019/08/16/%E5%AE%89%E5%8D%93APK/"/>
      <url>/2019/08/16/%E5%AE%89%E5%8D%93APK/</url>
      
        <content type="html"><![CDATA[<p><strong>一个APK文件通常包含以下文件：</strong></p><ul><li>class.dex: Dalvik字节码，可被Dalvik虚拟机执行。</li><li>AndroidManifest.xml: 一个Android清单文件，用户描述该应用程序的名称、版本号、所需权限、注册服务、链接到的其它应用程序。该文件使用XML文件格式。</li><li>META-INF文件夹：下面有3个文件<ul><li>MANIFEST.MF：清单信息</li><li>CERT.RSA：保存应用程序的证书和授权信息</li><li>CERT.SF：保存SHA-1信息资源列表</li></ul></li><li>res：APK所需要的资源文件夹</li><li>assets：不需编译的原始资源文件目录</li><li>resources.arsc：编译后的二进制资源文件</li><li>lib：库文件目录</li></ul><p><strong>Dalvik虚拟机与反编译：</strong></p><p>区别于JAVA虚拟机（JVM），安卓虚拟机称为Dalvik虚拟机（DVM）。Java虚拟机运行的是Java字节码，Dalvik虚拟机运行的是Dalvik字节码。Java虚拟机基于栈架构，Dalvik虚拟机基于寄存器架构。</p><p>DVM拥有专属的DEX可执行文件格式和指令集代码。smali和baksmali则是针对DEX执行文件格式的汇编器和反汇编器，反汇编后DEX文件会产生.smali后缀的代码文件，smali代码拥有特定的格式与语法，smali语言是对Dalvik虚拟机字节码的一种解释。</p><p><a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="noopener">apktool</a>工具是在smali工具的基础上进行封装和改进的，除了对DEX文件的汇编与反汇编功能外，还可以对APK中已编译成二进制的资源文件进行反编译和重新编译。如下是使用apktool工具来反汇编APK文件得到其对应文件信息（默认是输出到同名当前目录，可以使用-o参数输出到执行目录）：</p><pre><code>apktool d /Users/johnnie/Downloads/xxx.apk</code></pre><ul><li>AndroidManifest.xml 配置文件</li><li>apktool.yml 反编译生成的文件，供apktool使用</li><li>assets/ 不需反编译的资源文件目录</li><li>lib/ 不需反编译的库文件目录</li><li>res/ 反编译后的资源文件目录</li><li>smali/ 反编译生成的smali 源码文件目录</li></ul><p>其中，smali目录结构对应着原始的java源码src目录。（也是Dalvik字节码提取的关键位置，类似于Windows的EXE的opcode，可见都有其共通性！）</p><p><strong>Dalvik指令的分类与描述</strong></p><p>smali是对DVM字节码的一种解释，虽然不是官方标准语言，但所有语句都遵循一套语法规范。Dalvik opcodes的详细说明可以参考<a href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html" target="_blank" rel="noopener">这篇文章</a>，里面详细列举了Dalvik Opcode的含义及用法、例子。</p><p>由于Dalvik指令有两百多条，对需要的进行了分类和精简，去掉了无关的指令，只留下了M、R、G、I、T、P、V七大类核心的指令集合，并且只保留操作码字段，去掉了参数。M、R、G、I、T、P、V七大类指令集合分别代表了移动、返回、跳转、判断、取数据、存数据、调用方法七种类型的指令。如下分类与描述：</p><p><img src="/2019/08/16/安卓APK/opcodes.png" alt="Opcodes"></p>]]></content>
      
      
      <categories>
          
          <category> 恶意软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> DVM </tag>
            
            <tag> apktool </tag>
            
            <tag> smali </tag>
            
            <tag> opcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>恶意软件的特征提取</title>
      <link href="/2019/08/15/%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6/"/>
      <url>/2019/08/15/%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p><img src="/2019/08/15/恶意软件/clamav.png" alt="恶意软件"></p><p><strong>特征提取：</strong></p><ol><li>提取恶意软件进程行为调用系统APIs产生的序列；（恶意程序需在沙箱中执行，比如<a href="https://cuckoosandbox.org/" target="_blank" rel="noopener">Cuckoo</a>和<a href="https://www.virustotal.com" target="_blank" rel="noopener">Virustotal</a>，获取每个程序执行的日志）</li><li>因恶意程序对系统APIs的调用会被操控，可用恶意程序开始执行的头10秒产生的连续数据替代，如系统CPU使用，用户CPU使用，数据包发送，数据包接收，字节发送，字节接收，内存使用，缓存使用，当前运行进程总数，最大进程号等；</li><li>每个恶意程序PE文件里的APIs调用，可以使用<a href="https://www.pydoc.io/pypi/pefilenew-2.2/index.html" target="_blank" rel="noopener">pefile</a>，<a href="https://lief.quarkslab.com/" target="_blank" rel="noopener">LIEF</a>等工具提取，不仅包括APIs；</li><li>系统调用APIs名称为节点，入度为其节点权重，出度为其各连接节点的边权重，构建有向带权图，图的邻接矩阵可作为输入；</li><li>动静态特征：① 请求权限；② 敏感APIs；③ 动态行为；</li><li>抽取恶意软件的opcode，再使用n-gram提取100-300组特征；或是将抽取的opcode组成图，以图关系的邻接矩阵的奇异值分解的头2维度作为输入。</li></ol><p>参考：<a href="https://arxiv.org/pdf/1807.04739.pdf" target="_blank" rel="noopener">https://arxiv.org/pdf/1807.04739.pdf</a></p>]]></content>
      
      
      <categories>
          
          <category> 恶意软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 特征抽取 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 深度学习 </tag>
            
            <tag> 网络安全 </tag>
            
            <tag> 恶意软件 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
